<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="mpUser">
  	<select id="selectOrd" resultType="com.me.rentalme.model.entity.CallVo">
  		SELECT DATE_FORMAT(tb_odr110.ODR_DT, '%Y-%m-%d') AS odrDt,FN_NM('GDS_NM',GDS_CD) AS gdsNm, tb_odr110.GDS_CD AS gdsCd, tb_odr110.ODR_QTY AS odrQty, tb_odr110.AGREE_TEM AS agreeTem, tb_odr110.GDS_PRICE AS gdsPrice, tb_odr100.ODR_STS_GB_CD AS odrStsGbCd
		FROM tb_odr110
		INNER JOIN tb_odr100
		ON tb_odr110.ODR_NO = tb_odr100.ODR_NO;
  	</select>
  	
  	<insert id="insertReview">
  		INSERT INTO TB_GDS210 (GDS_CD, GDS_REVIEW_NO, GDS_REVIEW_DT, ODR_NO, ODR_SEQ, ODR_DT, MB_NO, CONTENT, GRADE)
		VALUES (#{gdsCd},
		(SELECT LPAD((SELECT COUNT(GDS_CD)+1 FROM TB_GDS210 A WHERE GDS_CD=#{gdsCd}),8,'0')),
		(SELECT DATE_FORMAT(NOW(),'%Y%m%d')), 
		(SELECT ODR_NO FROM TB_ODR100 WHERE MB_NO=(SELECT MB_NO FROM TB_USER100 WHERE USER_ID=#{userId})), 
		(SELECT ODR_SEQ FROM TB_ODR110 WHERE ODR_NO=(SELECT ODR_NO FROM TB_ODR100 WHERE MB_NO=(SELECT MB_NO FROM TB_USER100 WHERE USER_ID=#{userId}))), 
		(SELECT DATE_FORMAT((SELECT ODR_DT FROM TB_ODR110 WHERE ODR_NO=(SELECT ODR_NO FROM TB_ODR100 WHERE MB_NO=(SELECT MB_NO FROM TB_USER100 WHERE USER_ID=#{userId}))),'%Y%m%d')),
		(SELECT MB_NO FROM TB_USER100 WHERE USER_ID=#{userId}),
		#{content},
		#{grade})
  	</insert>
  	
  	<select id="selectCart" resultType="com.me.rentalme.model.entity.CallVo">
  		SELECT FN_NM('GDS_NM',GDS_CD) AS gdsNm, TB_CART100.ODR_QTY AS odrQty, TB_CART100.AGREE_TERM AS agreeTem, TB_CART100.GDS_PRICE AS gdsPrice
		FROM TB_CART100;
  	</select>
  
  	<select id="selectWish" resultType="com.me.rentalme.model.entity.CallVo">
  		SELECT DATE_FORMAT(TB_CALL100.CHG_DT, '%Y-%m-%d') AS chgDt, TB_USED100.MODEL_NM AS modelNm, TB_USED100.USED_GDS_PRICE as usedGdsPrice 
		FROM TB_CALL100 
		INNER JOIN TB_USED100 
		ON TB_CALL100.USED_GDS_NO = TB_USED100.USED_GDS_NO 
		WHERE CALL_STS_CD=1;
  	</select>
  	
  	<update id="delete" >
  		UPDATE TB_CALL100
		SET CALL_STS_CD=2
		WHERE USED_GDS_NO=#{USEDGDSNO};
  	</update>
  
  </mapper>